---
title: "程序是如何运行的"
date: 2024-03-24T09:26:16+08:00
lastmod: 2024-03-24T09:26:16+08:00
author: "zhaohan"
tags:
  - 计算机基础
---

# 1 整个过程

- 预编译：主要处理源代码文件中的以“#”开头的预编译指令。
- 编译：把预编译之后生成的xxx.i或xxx.ii文件，进行一系列词法分析、语法分析、语义分析及优化后，生成相应的汇编代码文件。
- 汇编：将汇编代码转变成机器可以执行的指令(机器码文件)。 
- 链接：目标文件再与库进行链接得到可执行文件.out。

# 2 链接
本质上来说库是一种可执行代码的二进制形式，可以被操作系统载入内存执行。库有两种：静态库（.a、.lib）和动态库（.so、.dll）。 windows上对应的是.lib .dll， linux上对应的是.a .so。

静态库在链接阶段，会将汇编生成的目标文件.o与引用到的库一起链接打包到可执行文件中。因此对应的链接方式称为静态链接。静态库对函数库的链接是放在编译时期完成的。程序在运行时与函数库再无瓜葛，移植方便。浪费空间和资源，因为所有相关的目标文件与牵涉到的函数库被链接合成一个可执行文件。

动态库在程序编译时并不会被连接到目标代码中，而是在程序运行是才被载入。不同的应用程序如果调用相同的库，那么在内存里只需要有一份该共享库的实例，规避了空间浪费问题。动态库的一个缺点是需要记录函数的引用，在程序运行时查询库来调用函数，需要时间，典型的时间换空间。